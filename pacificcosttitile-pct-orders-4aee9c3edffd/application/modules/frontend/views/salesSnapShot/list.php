<style type="text/css">
	.u-list {
	    margin-bottom: 15px;
	}
	.u-list, .u-list li {
	    margin: 0;
	    padding: 0;
	    list-style: none;
	}
	.u-list li:nth-child(2n+1) {
	    background: #cccccc45;
	}
	.u-list li {
	    padding: 10px;
	    display: table;
	    width: 100%;
	}
	.u-list .u-pic, .u-list .u-info {
	    display: block;
	    vertical-align: top;
	}
	.u-list .u-pic {
	    width: 25%;
	    height: 80px;
	    overflow: hidden;
	    border-radius: 100%;
	    margin-right: 10px;
	    float: left;
	}
	.u-list .u-pic img {
	    margin: 0;
	    border: 0;
	    max-width: 100%;
	}
	.u-list .u-info {
		width: 60%;
	    padding-top: 5px;
	    margin-left: 10px;
	    float: left;
	}
	.u-list .u-name {
	    font-weight: bold;
	    color: #000;
	}
	.u-list .u-count {
		float: right;
		font-size: 20px;
	}
	.no-report-image {
	    text-align: center;
	    background: #f0f0f0;
	    height: 80px;
	    padding-top: 16px;
	    font-size: 30px;
	    font-weight: 600;
	}
	.u-list li:nth-child(2n+1) .no-report-image{
	    background: #ffffff;
	}
	.report_switch_btn {
		height: 42px;
	    background: #d35411;
	    line-height: 1px;
	    padding: 25px 18px;
	    vertical-align: top;
	    display: inline-block;
	    font-size: 18px;
	    color: #fff;
	}
	.pma_val {
	    color: #d35400;
	    font-weight: bold;
	    text-align: center;
	}
	.padding-l-r {
		padding-left: 3rem;
		padding-right: 3rem;
	}
	.ui-title-block + .ui-decor-1a {
		margin-top: 22px;
		margin-bottom: 34px;
	}

	.ui-decor-1a {
		display: inline-block;
		width: 100px;
		height: 2px;
	}

	.bg-accent {
		background-color: #d35411;
	}

	tbody tr, thead tr {
		text-align: center;
	}

.smart-container {
    background: #ffffff;
    margin: 0px auto;
    -webkit-border-radius: 5px 5px 0 0;
    -moz-border-radius: 5px 5px 0 0;
    -o-border-radius: 5px 5px 0 0;
    border-radius: 5px 5px 0 0;
}
.smart-forms {
    font-family: "Roboto", Arial, Helvetica, sans-serif;
    line-height: 1.231;
    font-weight: 400;
    font-size: 14px;
    color: #34495E;
}
.smart-forms, .smart-forms * {
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
}

element.style {
}
.smart-forms, .smart-forms * {
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
}
* {
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
}

form {
    display: block;
    margin-top: 0em;
}
.smart-forms {
    font-family: "Roboto", Arial, Helvetica, sans-serif;
    line-height: 1.231;
    font-weight: 400;
    font-size: 14px;
    color: #34495E;
}
.smart-forms .form-body {
    padding: 40px 0px;
    padding-bottom: 20px;
}
.smart-forms .frm-row {
    margin: 0 -10px;
}
.smart-forms .frm-row:before, .smart-forms .frm-row:after {
    display: table;
    content: "";
    line-height: 0;
}


.smart-forms .frm-row .colm {
    min-height: 1px;
    padding-left: 10px;
    padding-right: 10px;
    position: relative;
    float: left;
}

.smart-forms .field {
    display: block;
    position: relative;
}

.smart-forms .section {
    margin-bottom: 22px;
}

.smart-forms .file {
    display: block;
    width: 100%;
}

.smart-forms .prepend-icon {
    display: inline-block;
    vertical-align: top;
    position: relative;
    width: 100%;
}

.smart-forms label, .smart-forms input, .smart-forms button, .smart-forms select, .smart-forms textarea {
    margin: 0;
    font-size: 14px;
    font-family: "Roboto", Arial, Helvetica, sans-serif;
    font-weight: 400;
    color: #34495E;
    outline: none;
}

.smart-forms .button {
    border: 0;
    height: 42px;
    color: #243140;
    line-height: 1;
    font-size: 15px;
    cursor: pointer;
    padding: 0 18px;
    text-align: center;
    vertical-align: top;
    background: #bdc3c7;
    display: inline-block;
    -webkit-user-drag: none;
    text-shadow: 0 1px rgba(255, 255, 255, 0.2);
}

.smart-forms a.button, .smart-forms span.button, .smart-forms label.button {
    line-height: 42px;
    text-decoration: none;
}

.smart-forms .file .button {
    position: absolute;
    top: 5px;
    right: 4px;
    float: none;
    height: 32px;
    line-height: 34px;
    padding: 0px 16px;
    z-index: 10;
    border-radius: 5px;
}

.smart-forms .file .gui-file {
    width: 100%;
    height: 100%;
    cursor: pointer;
    padding: 8px 10px;
    position: absolute;
    -moz-opacity: 0;
    opacity: 0;
    z-index: 11;
    bottom: 0;
    right: 0;
}

.smart-forms .select, .smart-forms .gui-input, .smart-forms .gui-textarea, .smart-forms .select > select, .smart-forms .select-multiple select {
    background: #fff;
    position: relative;
    vertical-align: top;
    border: 1px solid #cbd2d6;
    display: -moz-inline-stack;
    display: inline-block;
    *display: inline;
    color: #34495E;
    outline: none;
    height: 42px;
    width: 100%;
    *zoom: 1;
}

.smart-forms .prepend-icon > input, .smart-forms .prepend-icon > textarea, .smart-forms .prepend-icon > select {
    padding-left: 36px;
}

.smart-forms label, .smart-forms input, .smart-forms button, .smart-forms select, .smart-forms textarea {
    margin: 0;
    font-size: 14px;
    font-family: "Roboto", Arial, Helvetica, sans-serif;
    font-weight: 400;
    color: #34495E;
    outline: none;
}

.smart-forms button {
	color: #fff;
}

.smart-forms .prepend-icon > input, .smart-forms .prepend-icon > textarea, .smart-forms .prepend-icon > select {
    padding-left: 36px;
}

.smart-forms .gui-input, .smart-forms .gui-textarea {
    padding: 10px;
}

.smart-forms .prepend-icon .field-icon {
    left: 0;
}

.smart-forms .append-icon .field-icon, .smart-forms .prepend-icon .field-icon {
    top: 0;
    width: 42px;
    height: 42px;
    color: inherit;
    line-height: 35px;
    position: absolute;
    text-align: center;
    -webkit-transition: all 0.5s ease-out;
    -moz-transition: all 0.5s ease-out;
    -ms-transition: all 0.5s ease-out;
    -o-transition: all 0.5s ease-out;
    transition: all 0.5s ease-out;
    pointer-events: none;
    z-index: 99;
}

.smart-forms .append-icon .field-icon i, .smart-forms .prepend-icon .field-icon i {
    position: relative;
    font-size: 14px;
}

.smart-forms .field-icon i {
    color: #A2A6A8;
    position: relative;
    top: 0;
}
.text-center {
	text-align: center;
}

#report_listing .btn-icon-split .text {
	padding: 0.375rem 6px 0.375rem 6px;
	font-size: 14px;
}

.align-btn {
	display: flex;
	justify-content: space-evenly;
}
</style>

<section class="section-sm section-defaulta" >
	<div class="container-fluid padding-l-r">
		<div class="card shadow p-5">
			<div class="row">
				<div class="col-sm-12">
					<h2 class="ui-title-block ui-title-block_light">Sales Snap Shot
						<a href="<?php echo base_url('sales-activity-report'); ?>" class="btn btn-primary btn-icon-split pull-right mr-1">
							<span class="icon text-white-50">
								<i class="fa fa-tag"></i>
							</span>
							<span class="text">County Activity</span>
						</a>
                        <a href="<?php echo base_url('reports'); ?>" class="btn btn-primary btn-icon-split pull-right mr-1">
							<span class="icon text-white-50">
								<i class="fas fa-concierge-bell"></i>
							</span>
							<span class="text">Create F.A.R</span>
						</a>

						<a href="<?php echo base_url('pmas'); ?>" class="btn btn-primary btn-icon-split pull-right mr-1">
							<span class="icon text-white-50">
								<i class="fas fa-concierge-bell"></i>
							</span>
							<span class="text">Create Concierge</span>
						</a>
						<a href="<?php echo base_url('labels'); ?>" class="btn btn-primary btn-icon-split pull-right mr-1">
							<span class="icon text-white-50">
								<i class="fa fa-tag"></i>
							</span>
							<span class="text">Create Labels</span>
						</a>
					</h2>
						<!-- <a href="<?php echo base_url('pmas'); ?>" class="pull-right report_switch_btn">Create Concierge</a> -->
						<!-- <a style="margin-right:10px;" href="<?php echo base_url('labels'); ?>" class="pull-right report_switch_btn">Create Labels</a> -->

					<div class="ui-decor-1a bg-accent"></div>
				</div>
			</div>
			<div class="row">
				<div class="col-md-3">
					<div class="row">
						<div class="col-sm-9">
							<h5>Total Ran</h5>
						</div>
						<div class="col-sm-3">
							<h4 class="pma-total pma_val"> <?php echo $report_total; ?> </h4>
						</div>
					</div>
					<!-- <h2>
						<span>Representative(s)</span>

					</h2> -->
					<ul class="u-list">
						<?php
foreach ($salesReps as $key => $salesRep):
?>
						<li>
							<div class="u-pic">
							<?php

$image_url = trim(env('AWS_PATH') . $salesRep['sales_rep_report_image']);
if (!empty($salesRep['sales_rep_report_image'])): ?>
																<img src="<?php echo $image_url; ?>" alt="main-logo" class="retina">
								<?php else: ?>
								<div class="no-report-image"><span><?php echo strtoupper(substr(trim($salesRep['first_name']), 0, 1) . substr(trim($salesRep['last_name']), 0, 1)); ?></span></div>
								<?php endif;?>
							</div>
							<div class="u-info">
								<div class="u-name"><?php echo $salesRep['first_name'] . ' ' . $salesRep['last_name']; ?></div>
								<div><?php echo $salesRep['email_address']; ?></div>
								<div>
								<?php echo $salesRep['telephone_no']; ?>
								</div>
							</div>
							<div class="u-count">
								<div class="pma_val"><?php echo $salesRep['report_count']; ?></div>
							</div>
						</li>
						<?php
if ($key == 9) {
    break;
}
endforeach;
?>
					</ul>
						<?php if (count($salesReps) > 10): ?>
							<div class="pull-right">
								<a href="<?=base_url('reports/sales_rep');?>" class="btn btn-success">View All</a>
							</div>
						<?php endif;?>
				</div>
				<div class="col-md-1"></div>
				<div class="col-md-8">
					<h5 class="text-center" ><span>Create New Report</span>
						<!-- <a href="<?=base_url('pmas');?>" class="pull-right">Create PMA</a> -->

					</h5>
					<div class="smart-forms smart-container">
						<form method="POST" id="smart-form" enctype="multipart/form-data" novalidate="novalidate" action="<?php echo base_url('sales-snap-shot/importData'); ?>">
							<div class="form-body">
								<?php
$prev_data = $this->session->flashdata('_previous_data');
if ($this->session->flashdata('error')):
?>
								<div class="alert alert-danger" role="alert"><?php echo $this->session->flashdata('error'); ?></div>
								<?php
elseif ($this->session->flashdata('success')):
?>
								<div class="alert alert-success" role="alert"><?php echo $this->session->flashdata('success'); ?></div>
								<?php
endif;
?>
								<div class="frm-row">
									<div class="row">
										<div class="section colm colm6 col-md-6">
											<label class="field prepend-icon file">
												<span class="button"> Choose File </span>
												<input type="file" class="gui-file form-control" name="csvFile" id="csvFile"
												onChange="document.getElementById('uploader1').value = this.value;" accept=".csv">
												<input type="text" class="gui-input form-control" id="uploader1" placeholder="no file selected" readonly>
												<span class="field-icon"><i class="fa fa-upload"></i></span>
											</label>
										</div>

										<div class="section colm colm6 col-md-6">
											<label class="field prepend-icon">
												<input type="text" class="form-control" name="area_name" value="<?php echo (!empty($prev_data['area_name'])) ? $prev_data['area_name'] : ''; ?>" placeholder="What Area?">
												<span class="field-icon"><i class="fa fa-map-marker "></i></span>
											</label>
										</div>
									</div>

									<div class="row">

										<div class="section colm colm4 col-md-6 ">
											<select id="sales_rep" name="sales_rep" class="form-control" placeholder="Select Sales Representative">
												<option value="" >Select Sales Representative</option>
												<?php foreach ($salesReps as $salesRep): ?>
												<option value="<?php echo $salesRep['id']; ?>" <?php if (!empty($prev_data['sales_rep']) && $prev_data['sales_rep'] == $salesRep['id']) {echo 'selected';}?>><?php echo $salesRep['first_name'] . ' ' . $salesRep['last_name']; ?></option>
												<?php endforeach;?>
											</select>
											<i class="arrow"></i>
										</div>

										<div class="section colm colm4 col-md-6">
											<select id="month_option" name="month_option" class="form-control">
												<option value="">Select Month Option</option>
												<option value="3" <?php if (!empty($prev_data['month_option']) && $prev_data['month_option'] == "3") {echo 'selected';}?>>3</option>
                                                <option value="6" <?php if (!empty($prev_data['month_option']) && $prev_data['month_option'] == "6") {echo 'selected';}?>>6</option>
                                                <option value="12" <?php if (!empty($prev_data['month_option']) && $prev_data['month_option'] == "12") {echo 'selected';}?>>12</option>
											</select>
											<i class="arrow"></i>
										</div>
									</div>
									<div class="row">
										<div class="section colm colm4 col-md-6">
											<select id="property_type" name="property_type" class="form-control">
												<option value="">Select Types of Properties</option>
												<option value="SFR" <?php if (!empty($prev_data['property_type']) && $prev_data['property_type'] == "SFR") {echo 'selected';}?>>SFR</option>
                                                <option value="Condo" <?php if (!empty($prev_data['property_type']) && $prev_data['property_type'] == "Condo") {echo 'selected';}?>>Condo</option>
                                                <option value="2-4 Units" <?php if (!empty($prev_data['property_type']) && $prev_data['property_type'] == "2-4 Units") {echo 'selected';}?>>2-4 Units</option>
                                                <option value="5 Units & Up" <?php if (!empty($prev_data['property_type']) && $prev_data['property_type'] == "5 Units & Up") {echo 'selected';}?>>5 Units & Up</option>
											</select>
											<i class="arrow"></i>
										</div>
									</div>
									<div class="row">
										<div class="section colm colm4 col-md-6">
											<button type="reset" class="btn btn-danger btn-icon-split">
												<span class="icon text-white-50">
                                                    <i class="fas fa-refresh"></i>
                                                </span>
                                                <span class="text">Reset Form</span>
											</button>
											<button type="submit" class="btn btn-success btn-icon-split">
												<span class="icon text-white-50">
                                                    <i class="fas fa-save"></i>
                                                </span>
                                                <span class="text">Submit Form</span>
											</button>
										</div>
									</div>
								</div>
							</div>
						</form>
					</div>
					<div class="mt-5 text-center">
						<h5>Recent Sales Activity Reports</h5>
						<div class="table-container1">
							<div class="alert alert-success hide" id="successMsg"></div>
							<div class="alert alert-danger hide" id="errorMsg"></div>
							<table class="table table-type-3 typography-last-elem no-footer table-bordered" id="report_listing">
								<thead>
									<tr>
										<th>Date</th>
										<th>Sales Rep</th>
										<th>Area Name</th>
										<th>Download</th>
									</tr>
								</thead>
								<tbody>
									<?php
foreach ($reports_data as $report) {

    $pdf_url = trim(env('AWS_PATH') . 'sales-snap-shot/' . $report['report_url']);
    $email = $report['email_address'];
    ?>
									<tr>
										<td><span style="display:none;"><?php echo strtotime($report['created_at']); ?></span><?php echo date('d M y H:i', strtotime($report['created_at'])); ?></td>
										<td><?php echo $report['first_name'] . ' ' . $report['last_name']; ?></td>
										<td><?php echo $report['area_name']; ?></td>
										<td class="align-btn" >
										<?php
if (!empty($report['report_url'])): ?>
										<a href="<?php echo $pdf_url; ?>" class="btn btn-success btn-icon-split" target="_blank" download>
											<!-- <i class="fa fa-download" aria-hidden="true"></i> -->
											<span class="icon text-white-50">
												<i class="fas fa-download"></i>
											</span>
											<span class="text">Download</span>
										</a>
										<a href="javascript:void(0);" class="btn btn-success btn-icon-split" onclick="sendEmailToSalesRep('<?=$email;?>', '<?=$pdf_url;?>');">
											<!-- <i class="fa fa-download" aria-hidden="true"></i> -->
											<span class="icon text-white-50">
												<i class="fas fa-envelope-square "></i>
											</span>
											<span class="text">Send to Rep</span>
										</a>
										<?php endif;?>
										</td>
									</tr>
									<?php
}
?>

								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

<script src="<?php echo base_url(); ?>assets/libs/jquery-1.12.4.min.js"></script>

<script>

	function sendEmailToSalesRep(email, url) {
		$("#page-preloader").show();
		$.ajax({
			url: base_url + "send-sales-snap-shot-email",
			type: "post",
			data: {
				email : email,
				url: url,
				key: 'snapshot-email'
			},
			// async: false,
			success: function (response) {
				let res = JSON.parse(response);
				console.log(res);
				if (res.status == "success") {
					$('#successMsg').html(res.message).removeClass('hide').addClass('show');
					setTimeout(function () {
						$('#successMsg').html('').removeClass('show').addClass('hide');
					},3000);
				} else {
					$('#errorMsg').html(res.message).removeClass('hide').addClass('show');
					setTimeout(function () {
						$('#errorMsg').html('').removeClass('show').addClass('hide');
					},3000);
				}
				$("#page-preloader").hide();
			},
			complete: function (res) {
				$("#page-preloader").hide();
			}
		});
	}


</script>

